# Go Ecommerce API

A clean, modular REST API for ecommerce operations built with Go, PostgreSQL, and SQLC.

## Features

- **Products Management**: List and retrieve product details
- **Orders Management**: Create and manage customer orders
- **PostgreSQL Integration**: Type-safe database queries generated by SQLC
- **Clean Architecture**: Separation of concerns with handlers, services, and repository adapters
- **Environment Configuration**: Externalized config via `.env` files

## Project Structure

```
go_ecommerce_api/
├── cmd/
│   ├── main.go           # Application entry point
│   └── api.go            # API server setup
├── internal/
│   ├── adapters/
│   │   └── postgresql/   # Database adapter layer
│   │       ├── migrations/    # SQL migration files
│   │       └── sqlc/          # SQLC-generated database code
│   ├── env/              # Environment variable utility
│   ├── json/             # JSON utilities
│   ├── orders/           # Orders domain (handlers, service, types)
│   └── products/         # Products domain (handlers, service)
├── docker-compose.yaml   # Docker setup for PostgreSQL
├── go.mod                # Go module definition
├── sqlc.yaml             # SQLC configuration
└── README.md             # This file
```

## Getting Started

### Prerequisites

- Go 1.21+ ([install](https://golang.org/doc/install))
- PostgreSQL 13+ or Docker & Docker Compose
- SQLC ([install](https://docs.sqlc.dev/en/latest/overview/install.html))
- Goose ([install](https://github.com/pressly/goose)) for database migrations

### Installation

1. Clone the repository:
```bash
git clone https://github.com/matthosch/go_ecommerce_api.git
cd go_ecommerce_api
```

2. Install dependencies:
```bash
go mod download
```

3. Set up environment variables:
```bash
cp .env.example .env
# Edit .env with your database credentials
```

4. Run Database Migrations:
```bash
# Apply all pending migrations
goose up
```

### Running the API

#### Option 1: Using Docker Compose (Recommended)

Start PostgreSQL:
```bash
docker-compose up -d
```

Run the API:
```bash
go run ./cmd
```

The API will start on `http://localhost:8080` (or the configured port).

#### Option 2: Manual PostgreSQL Setup

1. Start PostgreSQL on your system
2. Create a database and user
3. Update `.env` with connection details
4. Run migrations:
```bash
go run ./cmd migrate
```

5. Start the API:
```bash
go run ./cmd
```

## API Endpoints

### Products
- `GET /products` — List all products
- `GET /products/:id` — Get a specific product by ID

### Orders
- `POST /orders` — Create a new order

## Development

### Generate Database Code

After modifying `queries.sql` or migrations, regenerate SQLC code:

```bash
sqlc generate
```

### Running Tests

```bash
go test ./...
```

### Code Linting

```bash
go vet ./...
```

## Project Architecture

### Layers

1. **Handlers** (`internal/products/handlers.go`, `internal/orders/handlers.go`)
   - HTTP request/response handling
   - Input validation
   - Route definitions

2. **Services** (`internal/products/service.go`, `internal/orders/service.go`)
   - Business logic
   - Orchestration of repository operations
   - Domain-specific rules

3. **Adapters** (`internal/adapters/postgresql/`)
   - Repository pattern implementation
   - SQLC-generated database queries
   - Database connection management

4. **Utilities**
   - `env/` — Utility to load environment variables
   - `json/` — JSON encoding/decoding helpers

### Adding a New Feature

1. Define SQL queries in `queries.sql`
2. Run `sqlc generate`
3. Create service in `internal/<domain>/service.go`
4. Create handlers in `internal/<domain>/handlers.go`
5. Wire routes in `cmd/api.go`

## Environment Variables

Use `.env` file in the root directory to store database details.

## Database Migrations

Migrations are stored in `internal/adapters/postgresql/migrations/`. They are applied in numerical order:
- `00001_create_products.sql` — Products table schema
- `00002_create_orders.sql` — Orders table schema

### Using Goose for Migrations

This project uses [Goose](https://github.com/pressly/goose) for database migration management.

#### Installation

```bash
go install github.com/pressly/goose/v3/cmd/goose@latest
```

#### Managing Migrations

```bash
# Run all pending migrations (up)
goose up

# Check migration status
goose status

# Rollback the last migration
goose down

# Rollback to a specific version
goose down-to 1
```

#### Creating New Migrations

1. Create a new migration file with Goose:
```bash
goose create <migration_name> sql
```

This generates a file like `000N_<migration_name>.sql` with up/down sections.

2. Edit the file and add your SQL:
```sql
-- +goose Up
CREATE TABLE new_table (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL
);

-- +goose Down
DROP TABLE new_table;
```

3. Apply the migration:
```bash
goose up
```

#### Docker Compose Integration

If using Docker Compose, you can run migrations inside the container:

```bash
docker-compose exec -it postgres goose -dir /migrations up
```

## Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## License

This project is licensed under the MIT License — see the LICENSE file for details.

## Support

For issues or questions, please open an issue on the repository.
